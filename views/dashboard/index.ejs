<!DOCTYPE html>
<html lang="pt-BR" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raven - Dashboard</title>

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <link rel="stylesheet" href="/vendor/css/simplebar.css">

    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&amp;display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="/css/style.css" />

    <link rel="stylesheet" href="/vendor/css/sweetalert2.min.css">
    <link rel="stylesheet" href="/vendor/css/tom-select.min.css">
    <link rel="stylesheet" type="text/css" href="/vendor/css/daterangepicker.css" />
</head>

<body
    class="font-theme flex flex-col h-full text-base font-normal bg-zinc-50 dark:bg-zinc-950 text-zinc-600 dark:text-zinc-300 text-left rtl:text-right">

    <%- include('../partials/sidebar') %>

        <main class="flex-1 lg:ms-64 flex flex-col app-content">

            <%- include('../partials/header') %>

                <div class="px-4 lg:px-8 pt-4 pb-4 flex flex-col sm:flex-row sm:items-center">
                    <div class="flex-grow mb-3 sm:mb-0">
                        <h2 class="text-xl font-semibold text-black dark:text-white">
                            Bem-vindo<%= (user && user.nome) ? " " + user.nome : "" %>!
                        </h2>
                        <p class="text-sm text-zinc-500 dark:text-zinc-400">
                            <%= (user && user.email) ? user.email : "" %>
                        </p>
                    </div>
                    <div class="flex flex-col">
                        <small class="text-muted block mb-1">Dados do período</small>
                        <div class="inline-flex w-auto max-w-xs dark:bg-zinc-900 items-center gap-1 cursor-pointer text-sm"
                            id="reportrange">
                            <i class="icon-[lucide--calendar-days]"></i>
                            <span></span><i class="icon-[lucide--chevron-down]"></i>
                        </div>
                    </div>
                </div>

                <div class="content lg:px-4 flex-grow relative">

                    <div id="preloader"
                        class="absolute inset-0 w-full h-[75vh] flex items-center justify-center z-50 hidden">
                        <div class="size-12 bg-white shadow-xl rounded-full flex items-center justify-center">
                            <div class="animate-spin rounded-full size-10 border-b-2 border-primary"></div>
                        </div>
                    </div>

                    <div class="px-4 mb-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="rounded-xl p-4 bg-white dark:bg-zinc-900 shadow-card flex items-center">
                            <div class="shrink-0 w-3/5">
                                <p class="mb-2">Vendas semanais</p>
                                <h4 class="text-2xl mb-1">R$ 59K</h4>
                                <span class="text-sm">
                                    <span class="text-green-500">+5,5%</span>
                                    <span class="text-muted">vs período anterior</span>
                                </span>
                            </div>
                            <div class="ps-3 w-2/5">
                                <div id="chart_tiny_weekly_sales" class="h-20 w-full"></div>
                            </div>
                        </div>

                        <div class="rounded-xl p-4 bg-white dark:bg-zinc-900 shadow-card flex items-center">
                            <div class="shrink-0 w-3/5">
                                <p class="mb-2">Taxa de rejeição</p>
                                <h4 class="text-2xl mb-1">47%</h4>
                                <span class="text-sm">
                                    <span class="text-green-500">+2,5%</span>
                                    <span class="text-muted">vs período anterior</span>
                                </span>
                            </div>
                            <div class="ps-3 w-2/5">
                                <div id="chart_tiny_weekly_bounce_rate" class="h-20 w-full"></div>
                            </div>
                        </div>

                        <div class="rounded-xl p-4 bg-white dark:bg-zinc-900 shadow-card flex items-center">
                            <div class="shrink-0 w-3/5">
                                <p class="mb-2">Economia de banda</p>
                                <h4 class="text-2xl mb-1">82%</h4>
                                <span class="text-sm">
                                    <span class="text-red-500">-0,5%</span>
                                    <span class="text-muted">vs período anterior</span>
                                </span>
                            </div>
                            <div class="ps-3 w-2/5 flex justify-end">
                                <div class="relative w-16 h-16" data-progress="82" data-show-value="true">
                                    <svg class="w-16 h-16 transform -rotate-90" viewBox="0 0 100 100">
                                        <circle class="text-primary-subtle" stroke-width="6" stroke="currentColor"
                                            fill="transparent" r="45" cx="50" cy="50"></circle>
                                        <circle class="text-primary progress-ring" stroke-width="6"
                                            stroke="currentColor" fill="transparent" r="45" cx="50" cy="50"
                                            stroke-linecap="round"
                                            style="stroke-dasharray: 282.743; stroke-dashoffset: 50.8938; transition: stroke-dashoffset 1s;">
                                        </circle>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <%- include('../partials/footer') %>

        </main>

        <script src="/js/theme.js"></script>
        <script src="/vendor/js/sweetalert2.all.min.js"></script>
        <script src="/vendor/js/echarts.min.js"></script>
        <script src="/js/dashboard-analytic.js" type="text/javascript"></script>
        <script type="text/javascript" src="/vendor/js/jquery.min.js"></script>
        <script type="text/javascript" src="/vendor/js/moment.min.js"></script>
        <script type="text/javascript" src="/vendor/js/daterangepicker.js"></script>

        <script type="text/javascript">
            $(function () {
                var start = moment().subtract(29, 'days');
                var end = moment();

                function cb(start, end) {
                    $('#reportrange span').html(start.format('MMM D, YY') + ' - ' + end.format('MMM D, YY'));
                }

                $('#reportrange').daterangepicker({
                    startDate: start,
                    endDate: end,
                    ranges: {
                        'Hoje': [moment(), moment()],
                        'Ontem': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                        'Últimos 7 dias': [moment().subtract(6, 'days'), moment()],
                        'Últimos 30 dias': [moment().subtract(29, 'days'), moment()],
                        'Este mês': [moment().startOf('month'), moment().endOf('month')],
                        'Mês passado': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                    }
                }, cb);

                cb(start, end);
            });
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // Pega o nome do usuário vindo do EJS. Se não tiver nome, fica vazio.
                const userName = "<%= (user && user.nome) ? user.nome : '' %>";

                // Mensagem personalizada
                const welcomeMessage = userName ? `Bem-vindo novamente, ${userName}!` : 'Bem-vindo novamente!';

                Swal.fire({
                    icon: 'success',
                    title: welcomeMessage,
                    toast: true,
                    position: 'top-end', // Canto superior direito
                    showConfirmButton: false,
                    timer: 4000,
                    timerProgressBar: true,
                    showCloseButton: true,
                    closeButtonHtml: '<span class="icon-[lucide--x]"></span>'
                });
            });
        </script>

</body>

</html>