<!DOCTYPE html>
<html lang="pt-BR" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raven - Quadro Scrum</title>

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <!-- Simplebar -->
    <link rel="stylesheet" href="/vendor/css/simplebar.css">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&amp;display=swap"
        rel="stylesheet">

    <!-- Main Style -->
    <link rel="stylesheet" href="/css/style.css" />
</head>

<body
    class="font-theme flex flex-col h-full text-base font-normal bg-zinc-50 dark:bg-zinc-950 text-zinc-600 dark:text-zinc-300">

    <%- include('partials/sidebar') %>

        <!-- Main -->
        <main class="flex-1 lg:ms-64 flex flex-col app-content">

            <%- include('partials/header') %>

                <!-- Page content -->
                <div class="content lg:px-4 flex-grow flex flex-col pt-4">

                    <div class="grid grid-cols-1 md:grid-cols-12 mb-4 gap-4 px-4">
                        <div class="md:col-span-5">
                            <h4 class="text-xl">Quadro de Tarefas</h4>
                            <p class="text-muted">Gerenciamento de projetos</p>
                        </div>
                        <div class="md:col-span-7">
                            <div class="flex flex-col gap-3.5 md:flex-row md:justify-end md:items-center">
                                <div class="flex items-center -space-x-3 shrink-0">
                                    <img data-bs-toggle="tooltip" data-bs-title="Emily"
                                        src="/images/avatars/thumb-1.jpg"
                                        class="size-8 border-2 border-zinc-100 dark:border-zinc-950 rounded-full relative">
                                    <img data-bs-toggle="tooltip" data-bs-title="Nikkita"
                                        src="/images/avatars/thumb-2.jpg"
                                        class="size-8 border-2 border-zinc-100 dark:border-zinc-950 rounded-full relative">
                                    <img data-bs-toggle="tooltip" data-bs-title="John" src="/images/avatars/thumb-9.jpg"
                                        class="size-8 border-2 border-zinc-100 dark:border-zinc-950 rounded-full relative">
                                    <span data-bs-toggle="tooltip" data-bs-title="3 mais membros"
                                        class="size-8 flex items-center justify-center bg-zinc-500 text-white border-2 border-zinc-100 dark:border-zinc-950 rounded-full relative text-xs">+3</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button type="button" class="btn btn-sm btn-default">
                                        <span class="icon-[lucide--user-plus] text-lg"></span>
                                    </button>
                                    <button data-bs-toggle="modal" data-bs-target="#modalNewScrumBoard" type="button"
                                        class="btn btn-sm btn-default">
                                        <span class="icon-[lucide--plus] text-lg me-1"></span> Novo Quadro
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filtros -->
                    <div class="px-4 mb-4">
                        <div class="rounded-2xl bg-white dark:bg-zinc-900 shadow-card p-4">
                            <div class="grid grid-cols-1 md:grid-cols-12 gap-4">

                                <!-- Empresa contratante -->
                                <div class="md:col-span-6">
                                    <label class="mb-2 block">Empresa contratante</label>

                                    <div class="relative w-full">
                                        <input type="hidden" id="contratante_id" value="">

                                        <input id="contratante_nome" type="text"
                                            class="input h-10 w-full !pe-11 bg-white dark:bg-zinc-900 cursor-pointer"
                                            placeholder="Selecione uma empresa..." readonly data-bs-toggle="modal"
                                            data-bs-target="#modal_contratante">

                                        <button id="btnBuscarContratante" type="button" data-bs-toggle="modal"
                                            data-bs-target="#modal_contratante"
                                            class="absolute right-2 top-1/2 -translate-y-1/2 size-8 rounded-md flex items-center justify-center hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-500 hover:text-zinc-900 dark:hover:text-white"
                                            title="Buscar empresa" aria-label="Buscar empresa">
                                            <span class="icon-[lucide--search] text-lg"></span>
                                        </button>
                                    </div>

                                    <p class="text-sm text-zinc-400 mt-2">
                                        Obrigatório para visualizar o quadro.
                                    </p>
                                </div>

                                <!-- Contrato Nº -->
                                <div class="md:col-span-6">
                                    <label class="mb-2 block">CONTRATO Nº</label>

                                    <div class="relative w-full">
                                        <input type="hidden" id="contrato_id" value="">

                                        <input id="contrato_numero" type="text"
                                            class="input h-10 w-full !pe-11 bg-white dark:bg-zinc-900 cursor-pointer"
                                            placeholder="Selecione um contrato..." readonly data-bs-toggle="modal"
                                            data-bs-target="#modal_contrato">

                                        <button id="btnBuscarContrato" type="button" data-bs-toggle="modal"
                                            data-bs-target="#modal_contrato"
                                            class="absolute right-2 top-1/2 -translate-y-1/2 size-8 rounded-md flex items-center justify-center hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-500 hover:text-zinc-900 dark:hover:text-white"
                                            title="Buscar contrato" aria-label="Buscar contrato">
                                            <span class="icon-[lucide--search] text-lg"></span>
                                        </button>
                                    </div>

                                    <p class="text-sm text-zinc-400 mt-2">
                                        Obrigatório para visualizar o quadro.
                                    </p>
                                </div>

                                <div class="md:col-span-12 flex items-center justify-end gap-2">
                                    <button id="btnLimparFiltros" type="button"
                                        class="btn border border-zinc-200 dark:border-zinc-700 hover:bg-zinc-50 dark:hover:bg-zinc-800 h-10 px-4">
                                        Limpar filtros
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- Mensagem quando não selecionou os 2 filtros -->
                    <div id="boardGateMessage" class="px-4 mb-4">
                        <div class="rounded-2xl bg-white dark:bg-zinc-900 shadow-card p-6">
                            <h5 class="text-lg mb-2">Selecione a empresa e o contrato</h5>
                            <p class="text-muted">
                                Para visualizar o Scrum Board, informe a <strong>Empresa contratante</strong> e o
                                <strong>CONTRATO Nº</strong>.
                            </p>
                        </div>
                    </div>

                    <!-- Scrum Board (começa oculto até selecionar os dois) -->
                    <div class="flex w-full flex-grow p-px space-x-4 flex-nowrap overflow-x-auto px-4 overflow-y-hidden mb-4"
                        id="scrum-board" style="display:none;">

                        <!-- Coluna: A Fazer -->
                        <div
                            class="w-[300px] min-w-[300px] me-4 drag-handle cursor-grab parent-task group flex flex-col mb-4 rounded-xl bg-white dark:bg-zinc-900 shadow-card">
                            <div class="flex items-center justify-between px-4 pt-4">
                                <h3 class="text-lg">A Fazer</h3>
                                <div class="relative">
                                    <button
                                        class="btn text-muted hover:bg-zinc-200 dark:hover:bg-zinc-700 hover:text-primary !p-1.5"
                                        type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                        <span class="icon-[lucide--more-vertical] text-lg"></span>
                                    </button>
                                    <div class="dropdown-menu z-50 absolute min-w-32 top-full !end-0 !start-auto">
                                        <a href="#!" class="dropdown-item">
                                            <span class="icon-[lucide--edit] dropdown-icon"></span>
                                            Renomear
                                        </a>
                                        <a href="#!" class="dropdown-item">
                                            <span class="icon-[lucide--trash] dropdown-icon"></span>
                                            Excluir
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <ul class="child-list min-h-full flex flex-col space-y-2 p-4">
                                <li
                                    class="p-4 rounded-lg bg-zinc-50 dark:bg-zinc-800 hover:shadow-xl child-task drag-handle shrink-0 cursor-grab">
                                    <h5 class="mb-2 text-lg">PGR - PROGRAMA DE GERENCIAMENTO DE RISCOS</h5>
                                    <span class="badge bg-sky-500/10 text-sky-500">Baixa prioridade</span>
                                    <div class="pt-4 flex items-center justify-between">
                                        <div class="flex items-center shrink-0">
                                            <img src="/images/avatars/thumb-1.jpg"
                                                class="size-8 border-2 border-zinc-50 dark:border-zinc-800 rounded-full relative">
                                            <img src="/images/avatars/thumb-2.jpg"
                                                class="size-8 border-2 border-zinc-50 dark:border-zinc-800 rounded-full relative -ms-3">
                                        </div>
                                        <div class="inline-flex text-sm items-center text-muted">
                                            <span class="icon-[lucide--calendar-days] me-1"></span>
                                            <span>18 Jun</span>
                                        </div>
                                    </div>
                                </li>
                                <li
                                    class="p-4 rounded-lg bg-zinc-50 dark:bg-zinc-800 hover:shadow-xl child-task drag-handle shrink-0 cursor-grab">
                                    <h5 class="mb-2 text-lg">PCMSO - PROGRAMA DE CONTROLE MÉDICO DE SAÚDE OCUPACIONAL
                                    </h5>
                                    <span class="badge bg-red-500/10 text-red-500">Alta prioridade</span>
                                    <div class="pt-4 flex items-center justify-between">
                                        <div class="flex items-center shrink-0">
                                            <img src="/images/avatars/thumb-7.jpg"
                                                class="size-8 border-2 border-zinc-50 dark:border-zinc-800 rounded-full relative">
                                            <img src="/images/avatars/thumb-8.jpg"
                                                class="size-8 border-2 border-zinc-50 dark:border-zinc-800 rounded-full relative -ms-3">
                                        </div>
                                        <div class="inline-flex text-sm items-center text-muted">
                                            <span class="icon-[lucide--calendar-days] me-1"></span>
                                            <span>20 Jun</span>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <!-- Coluna: Em Progresso -->
                        <div
                            class="w-[300px] min-w-[300px] drag-handle cursor-grab parent-task group flex flex-col mb-4 rounded-xl bg-white dark:bg-zinc-900 shadow-card">
                            <div class="flex items-center justify-between px-4 pt-4">
                                <h3 class="text-lg">Em Progresso</h3>
                                <div class="relative">
                                    <button
                                        class="btn text-muted hover:bg-zinc-200 dark:hover:bg-zinc-700 hover:text-primary !p-1.5"
                                        type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                        <span class="icon-[lucide--more-vertical] text-lg"></span>
                                    </button>
                                    <div class="dropdown-menu z-50 absolute min-w-32 top-full !end-0 !start-auto">
                                        <a href="#!" class="dropdown-item">
                                            <span class="icon-[lucide--edit] dropdown-icon"></span>
                                            Renomear
                                        </a>
                                        <a href="#!" class="dropdown-item">
                                            <span class="icon-[lucide--trash] dropdown-icon"></span>
                                            Excluir
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <ul class="child-list min-h-full flex flex-col space-y-2 p-4">
                                <li
                                    class="p-4 rounded-lg bg-zinc-50 dark:bg-zinc-800 hover:shadow-xl child-task drag-handle shrink-0 cursor-grab">
                                    <h5 class="mb-2 text-lg">NR 06 - EQUIPAMENTOS DE PROTEÇÃO INDIVIDUAL</h5>
                                    <span class="badge bg-amber-500/10 text-amber-500">Média prioridade</span>
                                    <div class="pt-4 flex items-center justify-between">
                                        <div class="flex items-center shrink-0">
                                            <img src="/images/avatars/thumb-4.jpg"
                                                class="size-8 border-2 border-zinc-50 dark:border-zinc-800 rounded-full relative">
                                            <img src="/images/avatars/thumb-5.jpg"
                                                class="size-8 border-2 border-zinc-50 dark:border-zinc-800 rounded-full relative -ms-3">
                                        </div>
                                        <div class="inline-flex text-sm items-center text-muted">
                                            <span class="icon-[lucide--calendar-days] me-1"></span>
                                            <span>22 Jun</span>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <!-- Coluna: Em Revisão -->
                        <div
                            class="w-[300px] min-w-[300px] drag-handle cursor-grab parent-task group flex flex-col mb-4 rounded-xl bg-white dark:bg-zinc-900 shadow-card">
                            <div class="flex items-center justify-between px-4 pt-4">
                                <h3 class="text-lg">Em Revisão</h3>
                                <div class="relative">
                                    <button
                                        class="btn text-muted hover:bg-zinc-200 dark:hover:bg-zinc-700 hover:text-primary !p-1.5"
                                        type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                        <span class="icon-[lucide--more-vertical] text-lg"></span>
                                    </button>
                                    <div class="dropdown-menu z-50 absolute min-w-32 top-full !end-0 !start-auto">
                                        <a href="#!" class="dropdown-item">
                                            <span class="icon-[lucide--edit] dropdown-icon"></span>
                                            Renomear
                                        </a>
                                        <a href="#!" class="dropdown-item">
                                            <span class="icon-[lucide--trash] dropdown-icon"></span>
                                            Excluir
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <ul class="child-list min-h-full flex flex-col space-y-2 p-4">
                                <li
                                    class="p-4 rounded-lg bg-zinc-50 dark:bg-zinc-800 hover:shadow-xl child-task drag-handle shrink-0 cursor-grab">
                                    <h5 class="mb-2 text-lg">PGR - PROGRAMA DE GERENCIAMENTO DE RISCOS</h5>
                                    <span class="badge bg-sky-500/10 text-sky-500">Baixa prioridade</span>
                                    <div class="pt-4 flex items-center justify-between">
                                        <div class="flex items-center shrink-0">
                                            <img src="/images/avatars/thumb-1.jpg"
                                                class="size-8 border-2 border-zinc-50 dark:border-zinc-800 rounded-full relative">
                                        </div>
                                        <div class="inline-flex text-sm items-center text-muted">
                                            <span class="icon-[lucide--calendar-days] me-1"></span>
                                            <span>25 Jun</span>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>

                        <!-- Coluna: Concluído -->
                        <div
                            class="w-[300px] min-w-[300px] drag-handle cursor-grab parent-task group flex flex-col mb-4 rounded-xl bg-white dark:bg-zinc-900 shadow-card">
                            <div class="flex items-center justify-between px-4 pt-4">
                                <h3 class="text-lg">Concluído</h3>
                                <div class="relative">
                                    <button
                                        class="btn text-muted hover:bg-zinc-200 dark:hover:bg-zinc-700 hover:text-primary !p-1.5"
                                        type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                        <span class="icon-[lucide--more-vertical] text-lg"></span>
                                    </button>
                                    <div class="dropdown-menu z-50 absolute min-w-32 top-full !end-0 !start-auto">
                                        <a href="#!" class="dropdown-item">
                                            <span class="icon-[lucide--edit] dropdown-icon"></span>
                                            Renomear
                                        </a>
                                        <a href="#!" class="dropdown-item">
                                            <span class="icon-[lucide--trash] dropdown-icon"></span>
                                            Excluir
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <ul class="child-list min-h-full flex flex-col space-y-2 p-4">
                                <li
                                    class="p-4 rounded-lg bg-zinc-50 dark:bg-zinc-800 hover:shadow-xl child-task drag-handle shrink-0 cursor-grab">
                                    <h5 class="mb-2 text-lg">PGR - PROGRAMA DE GERENCIAMENTO DE RISCOS</h5>
                                    <span class="badge bg-green-500/10 text-green-500">Concluído</span>
                                    <div class="pt-4 flex items-center justify-between">
                                        <div class="flex items-center shrink-0">
                                            <img src="/images/avatars/thumb-7.jpg"
                                                class="size-8 border-2 border-zinc-50 dark:border-zinc-800 rounded-full relative">
                                        </div>
                                        <div class="inline-flex text-sm items-center text-muted">
                                            <span class="icon-[lucide--calendar-days] me-1"></span>
                                            <span>15 Jun</span>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>

                    </div>
                </div>

                <%- include('partials/footer') %>
        </main>

        <!-- Modal Novo Quadro -->
        <div id="modalNewScrumBoard" role="dialog" class="modal fade fixed w-full h-full left-0 top-0 z-[60]"
            tabindex="-1">
            <div class="modal-dialog relative m-4 min-h-[calc(100%-2rem)] pointer-events-none">
                <div
                    class="modal-content max-w-[25rem] mx-auto bg-white relative dark:bg-zinc-900 rounded-xl w-full pointer-events-auto">
                    <button type="button" class="absolute end-2 top-2 btn btn-default !size-8 !p-0 !rounded-full"
                        data-bs-dismiss="modal">
                        <span class="icon-[lucide--x] text-lg"></span>
                    </button>
                    <div class="p-4 lg:p-6">
                        <div class="mb-4">
                            <h5 class="text-lg mb-1">Adicionar Novo Quadro</h5>
                        </div>
                        <div class="flex items-center gap-2">
                            <input name="addBoard" type="text" class="w-full input input-lg"
                                placeholder="Título do Quadro" autofocus />
                            <button type="button"
                                class="btn btn-lg bg-primary hover:bg-primary-deep text-white">Adicionar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal: Empresa Contratante -->
        <div id="modal_contratante" role="dialog" class="modal fade fixed inset-0 z-[70]" tabindex="-1">
            <div class="modal-dialog pointer-events-none w-full h-full flex items-center justify-center p-4">
                <div
                    class="modal-content pointer-events-auto w-full max-w-[40rem] bg-white dark:bg-zinc-900 rounded-xl">
                    <div class="p-4 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between">
                        <h5 class="text-lg">Pesquisar empresa contratante</h5>
                        <button type="button" class="btn !p-2" data-bs-dismiss="modal" aria-label="Fechar">
                            <span class="icon-[lucide--x] text-lg"></span>
                        </button>
                    </div>

                    <div class="p-4">
                        <div class="relative mb-3">
                            <input id="contratanteSearch" type="search" class="input !ps-9 w-full"
                                placeholder="Buscar empresa...">
                            <span
                                class="iconify icon-[lucide--search] pointer-events-none absolute start-0 top-0 h-full flex items-center justify-center ms-3 text-muted"></span>
                        </div>

                        <div class="max-h-[360px] overflow-auto border border-zinc-200 dark:border-zinc-800 rounded-lg">
                            <table class="table-default w-full">
                                <thead>
                                    <tr>
                                        <th>Empresa</th>
                                        <th class="text-right">Selecionar</th>
                                    </tr>
                                </thead>

                                <tbody id="contratanteList">
                                    <tr data-id="1" data-nome="Empresa Exemplo LTDA">
                                        <td class="font-semibold text-zinc-900 dark:text-white">Empresa Exemplo LTDA
                                        </td>
                                        <td class="text-right">
                                            <button type="button"
                                                class="btn bg-primary text-white hover:bg-primary-deep btnPickContratante">
                                                Selecionar
                                            </button>
                                        </td>
                                    </tr>
                                    <tr data-id="2" data-nome="Cliente ABC S/A">
                                        <td class="font-semibold text-zinc-900 dark:text-white">Cliente ABC S/A</td>
                                        <td class="text-right">
                                            <button type="button"
                                                class="btn bg-primary text-white hover:bg-primary-deep btnPickContratante">
                                                Selecionar
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <p class="text-sm text-zinc-400 mt-3">
                            Depois você pode substituir essa lista por dados vindos do banco (EJS/rotas).
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal: Contrato Nº -->
        <div id="modal_contrato" role="dialog" class="modal fade fixed inset-0 z-[70]" tabindex="-1">
            <div class="modal-dialog pointer-events-none w-full h-full flex items-center justify-center p-4">
                <div
                    class="modal-content pointer-events-auto w-full max-w-[40rem] bg-white dark:bg-zinc-900 rounded-xl">
                    <div class="p-4 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between">
                        <h5 class="text-lg">Pesquisar contrato</h5>
                        <button type="button" class="btn !p-2" data-bs-dismiss="modal" aria-label="Fechar">
                            <span class="icon-[lucide--x] text-lg"></span>
                        </button>
                    </div>

                    <div class="p-4">
                        <div class="relative mb-3">
                            <input id="contratoSearch" type="search" class="input !ps-9 w-full"
                                placeholder="Buscar contrato...">
                            <span
                                class="iconify icon-[lucide--search] pointer-events-none absolute start-0 top-0 h-full flex items-center justify-center ms-3 text-muted"></span>
                        </div>

                        <div class="max-h-[360px] overflow-auto border border-zinc-200 dark:border-zinc-800 rounded-lg">
                            <table class="table-default w-full">
                                <thead>
                                    <tr>
                                        <th>Contrato Nº</th>
                                        <th class="text-right">Selecionar</th>
                                    </tr>
                                </thead>

                                <tbody id="contratoList">
                                    <tr data-id="9001" data-numero="CTR-2026-0001">
                                        <td class="font-semibold text-zinc-900 dark:text-white">CTR-2026-0001</td>
                                        <td class="text-right">
                                            <button type="button"
                                                class="btn bg-primary text-white hover:bg-primary-deep btnPickContrato">
                                                Selecionar
                                            </button>
                                        </td>
                                    </tr>
                                    <tr data-id="9002" data-numero="CTR-2026-0002">
                                        <td class="font-semibold text-zinc-900 dark:text-white">CTR-2026-0002</td>
                                        <td class="text-right">
                                            <button type="button"
                                                class="btn bg-primary text-white hover:bg-primary-deep btnPickContrato">
                                                Selecionar
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <p class="text-sm text-zinc-400 mt-3">
                            Depois você pode substituir essa lista por dados vindos do banco (EJS/rotas).
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="/js/theme.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

        <script>
            // Ordenação de colunas
            Sortable.create(document.getElementById('scrum-board'), {
                animation: 150,
                handle: '.drag-handle',
                ghostClass: 'sortable-ghost',
                draggable: '.parent-task',
            });

            // Ordenação de tarefas dentro das colunas
            document.querySelectorAll('.child-list').forEach(childList => {
                Sortable.create(childList, {
                    group: 'nested-tasks',
                    animation: 150,
                    handle: '.drag-handle',
                    ghostClass: 'sortable-ghost',
                    draggable: '.child-task',
                });
            });
        </script>

        <script>
            (function () {
                // Gate: só mostrar board se Empresa e Contrato estiverem ok
                const boardEl = document.getElementById('scrum-board');
                const gateMsgEl = document.getElementById('boardGateMessage');

                const contratanteIdEl = document.getElementById('contratante_id');
                const contratanteNomeEl = document.getElementById('contratante_nome');

                const contratoIdEl = document.getElementById('contrato_id');
                const contratoNumeroEl = document.getElementById('contrato_numero');

                const btnLimpar = document.getElementById('btnLimparFiltros');

                function isFilled(el) {
                    return !!(el && String(el.value || '').trim());
                }

                function updateBoardGate() {
                    const okEmpresa = isFilled(contratanteIdEl) && isFilled(contratanteNomeEl);
                    const okContrato = isFilled(contratoIdEl) && isFilled(contratoNumeroEl);

                    const canShow = okEmpresa && okContrato;

                    if (boardEl) boardEl.style.display = canShow ? '' : 'none';
                    if (gateMsgEl) gateMsgEl.style.display = canShow ? 'none' : '';
                }

                updateBoardGate();

                // Modal: Empresa Contratante
                const contratanteSearch = document.getElementById('contratanteSearch');
                const contratanteList = document.getElementById('contratanteList');

                contratanteSearch?.addEventListener('input', () => {
                    const q = (contratanteSearch.value || '').toLowerCase();
                    contratanteList?.querySelectorAll('tr').forEach(tr => {
                        const nome = (tr.getAttribute('data-nome') || '').toLowerCase();
                        tr.style.display = nome.includes(q) ? '' : 'none';
                    });
                });

                contratanteList?.addEventListener('click', (e) => {
                    const btn = e.target.closest('.btnPickContratante');
                    if (!btn) return;

                    const tr = btn.closest('tr');
                    const id = tr?.getAttribute('data-id') || '';
                    const nome = tr?.getAttribute('data-nome') || '';

                    if (contratanteIdEl) contratanteIdEl.value = id;
                    if (contratanteNomeEl) contratanteNomeEl.value = nome;

                    const modalEl = document.getElementById('modal_contratante');
                    if (window.bootstrap && modalEl) {
                        window.bootstrap.Modal.getOrCreateInstance(modalEl).hide();
                    }

                    updateBoardGate();
                });

                // Modal: Contrato Nº
                const contratoSearch = document.getElementById('contratoSearch');
                const contratoList = document.getElementById('contratoList');

                contratoSearch?.addEventListener('input', () => {
                    const q = (contratoSearch.value || '').toLowerCase();
                    contratoList?.querySelectorAll('tr').forEach(tr => {
                        const numero = (tr.getAttribute('data-numero') || '').toLowerCase();
                        tr.style.display = numero.includes(q) ? '' : 'none';
                    });
                });

                contratoList?.addEventListener('click', (e) => {
                    const btn = e.target.closest('.btnPickContrato');
                    if (!btn) return;

                    const tr = btn.closest('tr');
                    const id = tr?.getAttribute('data-id') || '';
                    const numero = tr?.getAttribute('data-numero') || '';

                    if (contratoIdEl) contratoIdEl.value = id;
                    if (contratoNumeroEl) contratoNumeroEl.value = numero;

                    const modalEl = document.getElementById('modal_contrato');
                    if (window.bootstrap && modalEl) {
                        window.bootstrap.Modal.getOrCreateInstance(modalEl).hide();
                    }

                    updateBoardGate();
                });

                // Botão: limpar filtros
                btnLimpar?.addEventListener('click', () => {
                    if (contratanteIdEl) contratanteIdEl.value = '';
                    if (contratanteNomeEl) contratanteNomeEl.value = '';
                    if (contratoIdEl) contratoIdEl.value = '';
                    if (contratoNumeroEl) contratoNumeroEl.value = '';

                    if (contratanteSearch) contratanteSearch.value = '';
                    contratanteList?.querySelectorAll('tr').forEach(tr => tr.style.display = '');

                    if (contratoSearch) contratoSearch.value = '';
                    contratoList?.querySelectorAll('tr').forEach(tr => tr.style.display = '');

                    updateBoardGate();
                });
            })();
        </script>

</body>

</html>